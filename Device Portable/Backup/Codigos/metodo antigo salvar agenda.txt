var
  fdmTempAgenda : TFDMemTable;
  fdmTempAgendaAluno : TFDMemTable;
  fdmTempAgendaTurma : TFDMemTable;
  LDataSet: TFDDataSet;
  Exceptions:string;
begin
  try
    Result:='';
    fdmTempAgenda := TFDMemTable.Create(self);
    fdmTempAgendaAluno := TFDMemTable.Create(self);
    fdmTempAgendaTurma := TFDMemTable.Create(self);
    Exceptions:=EmptyStr;

    try
      //Pegando dados da agenda
      LDataSet := TFDJSONDataSetsReader.GetListValueByName(LDataSetList,'agenda');
      CopyDataSetByRecord(LDataSet,fdqAgenda,Exceptions);

      {codigo OK}
{      if LDataSet.RecordCount >= 1 then
      begin
        fdmTempAgenda.Active := False;
        fdmTempAgenda.AppendData(LDataSet);
        //CopyDataSet(fdmTempAgenda,fdqAgenda,False,[coAppend]);

        fdqAgenda.Active:=True;
        fdmTempAgenda.Active:=True;
        fdmTempAgenda.First;
        while not (fdmTempAgenda.Eof) do
        begin
          try
            fdqAgenda.Append;
            fdqAgenda.CopyRecord(fdmTempAgenda);

            fdqAgenda.Post;
            fdmTempAgenda.Next;
          except on E:Exception do
          begin
            Result:= 'Erro ao salvar agenda' +
                      fdmTempAgenda.FieldByName('agenda_id').AsString +#13 + E.Message;
            fdmTempAgenda.Next;
          end;
          end;
        end;
      end;
}

      //Pegando dados da agenda_aluno
      LDataSet := TFDJSONDataSetsReader.GetListValueByName(LDataSetList,'agenda_aluno');
      if LDataSet.RecordCount >= 1 then
      begin
        fdmTempAgendaAluno.Active := False;
        fdmTempAgendaAluno.AppendData(LDataSet);
        CopyDataSet(fdmTempAgendaAluno,fdqAgendaAluno,False,[coAppend]);
      end;

      //Pegando dados da agenda_turma
      LDataSet := TFDJSONDataSetsReader.GetListValueByName(LDataSetList,'agenda_turma');
      if LDataSet.RecordCount >= 1 then
      begin
        fdmTempAgendaTurma.Active := False;
        fdmTempAgendaTurma.AppendData(LDataSet);
        CopyDataSet(fdmTempAgendaTurma,fdqAgendaTurma,False,[coAppend]);
      end;


    except on E:Exception do
      Result:= 'Erro ao salvar agenda' + #13 + E.Message;
    end;

  finally
    fdmTempAgenda.DisposeOf;
    fdmTempAgendaAluno.DisposeOf;
    fdmTempAgendaTurma.DisposeOf;
  end;