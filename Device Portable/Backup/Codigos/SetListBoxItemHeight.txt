
procedure TfrmAgendaEscolaView.SetListBoxItemHeight(ListBoxItem: TListBoxItem);
var
  myLayout: TTextLayout;
  i: integer;
  aPoint: TPointF;
  HeightItem:Integer;
  Multiplicador: Integer;
  Soma:Integer;
begin
  myLayout := TTextLayoutManager.DefaultTextLayout.Create;
  myLayout.BeginUpdate;

  // Setting the layout MaxSize
  aPoint.X := lstboxAgenda.Width;
  aPoint.Y := lstboxAgenda.Height;

  myLayout.MaxSize:= aPoint;
  myLayout.Text:=ListBoxItem.Text;
  myLayout.WordWrap:= True ;
  myLayout.Font:=ListBoxItem.Font;
  myLayout.HorizontalAlign:= ListBoxItem.TextSettings.HorzAlign;
  myLayout.VerticalAlign:= ListBoxItem.TextSettings.VertAlign;
  myLayout.Padding:=ListBoxItem.Padding;
  myLayout.EndUpdate;

  //HeightItem:=  Trunc(myLayout.TextHeight) + 6;
  HeightItem:=  Trunc(myLayout.Height);

  if HeightItem < 25 then
    HeightItem:= 25;


  if HeightItem > 30 then
  begin
    Multiplicador:= 10;
    Soma:= 20;
  end;

  if HeightItem > 300 then
  begin
    Multiplicador:= 22;
    Soma:= 25;
  end;

  if HeightItem > 400 then
  begin
    Multiplicador:= 25;
    Soma:= 30;
  end;

  if HeightItem > 500 then
  begin
    Multiplicador:= 25;
    Soma:= 30;
  end;

  if HeightItem > 700 then
  begin
    Multiplicador:= 26;
    Soma:= 33;
  end;

  if HeightItem > 30 then
  begin
    HeightItem:= HeightItem + (Trunc((HeightItem  / 60) * Multiplicador));
    HeightItem:= HeightItem + Soma;
  end;

  ListBoxItem.Height := HeightItem;
end;